<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<AnchorPane prefHeight="700.0" prefWidth="700.0" styleClass="root-pane" 
            xmlns="http://javafx.com/javafx/17" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.sistemruangan.view.UserPeminjamanFormController">
   <children>
      <VBox spacing="20.0" AnchorPane.topAnchor="20.0" AnchorPane.leftAnchor="20.0" 
            AnchorPane.rightAnchor="20.0" AnchorPane.bottomAnchor="20.0">
         <children>
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="15.0" 
                  style="-fx-background-color: #5B9BD5; -fx-padding: 20; -fx-background-radius: 8;">
               <children>
                  <Label text="ðŸ“ Form Pengajuan Peminjaman" style="-fx-text-fill: white;">
                     <font>
                        <Font name="System Bold" size="20.0" />
                     </font>
                  </Label>
                  <Region HBox.hgrow="ALWAYS" />
                  <Button fx:id="btnKembali" text="â† Kembali" onAction="#handleKembali"
                          style="-fx-background-color: white; -fx-text-fill: #5B9BD5; -fx-font-weight: bold;" />
               </children>
            </HBox>
            
            <Separator />
            
            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
               <content>
                  <VBox spacing="15.0" style="-fx-padding: 10;">
                     <children>
                        <!-- Nama Peminjam -->
                        <VBox spacing="5.0">
                           <children>
                              <Label text="Nama Peminjam:" style="-fx-font-weight: bold;" />
                              <Label fx:id="lblNamaPeminjam" text="User" 
                                     style="-fx-font-size: 14px; -fx-background-color: #E3F2FD; -fx-padding: 8;" />
                           </children>
                        </VBox>
                        
                        <!-- Gedung & Ruangan -->
                        <HBox spacing="15.0">
                           <children>
                              <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                 <children>
                                    <Label text="Pilih Gedung: *" style="-fx-font-weight: bold;" />
                                    <ComboBox fx:id="cbGedung" maxWidth="Infinity" 
                                              promptText="Pilih gedung" 
                                              onAction="#handleGedungChange" />
                                 </children>
                              </VBox>
                              <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                 <children>
                                    <Label text="Pilih Ruangan: *" style="-fx-font-weight: bold;" />
                                    <ComboBox fx:id="cbRuangan" maxWidth="Infinity" 
                                              promptText="Pilih ruangan (Pilih gedung dulu)" 
                                              onAction="#handleRuanganChange" />
                                 </children>
                              </VBox>
                           </children>
                        </HBox>
                        
                        <VBox fx:id="vboxInfoRuangan" visible="false" managed="false"
                              style="-fx-background-color: #f0f0f0; -fx-padding: 10; -fx-background-radius: 5;">
                           <children>
                              <Label text="ðŸ“ Detail Ruangan" style="-fx-font-weight: bold; -fx-text-fill: #5B9BD5;" />
                              <GridPane hgap="10" vgap="5">
                                 <columnConstraints>
                                    <ColumnConstraints minWidth="80" />
                                    <ColumnConstraints hgrow="ALWAYS" />
                                 </columnConstraints>
                                 <children>
                                    <Label text="Kapasitas" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <Label fx:id="lblKapasitas" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0" style="-fx-font-weight: bold;" />
                                    
                                    <Label text="Fasilitas" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <VBox fx:id="vboxFasilitas" GridPane.columnIndex="1" GridPane.rowIndex="1" spacing="2" />
                                 </children>
                              </GridPane>
                           </children>
                        </VBox>
                        
                        <!-- JENIS KEGIATAN - CRITICAL FIX -->
                        <VBox spacing="8.0">
                           <children>
                              <Label text="Jenis Kegiatan: *" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                              
                              <RadioButton fx:id="rbKuliah" selected="true" onAction="#handleJenisKegiatanChange">
                                 <graphic>
                                    <Label text="Kuliah (Langsung Disetujui)" style="-fx-font-size: 13px;" />
                                 </graphic>
                              </RadioButton>
                              
                              <RadioButton fx:id="rbNonKuliah" onAction="#handleJenisKegiatanChange">
                                 <graphic>
                                    <Label text="Lainnya (Perlu Persetujuan Admin)" style="-fx-font-size: 13px;" />
                                 </graphic>
                              </RadioButton>
                              
                              <Label text="â„¹ï¸ Kuliah: disetujui otomatis | Lainnya: perlu approval admin" 
                                     style="-fx-text-fill: #666; -fx-font-size: 11px;" />
                           </children>
                        </VBox>
                        
                        <!-- Keperluan -->
                        <VBox spacing="5.0">
                           <children>
                              <Label text="Keperluan: *" style="-fx-font-weight: bold;" />
                              <TextArea fx:id="txtKeperluan" prefRowCount="3" 
                                        promptText="Jelaskan keperluan peminjaman..." 
                                        wrapText="true" />
                           </children>
                        </VBox>
                        
                        <!-- Form Lainnya (hidden by default) -->
                        <VBox fx:id="vboxNonKuliah" spacing="10.0" visible="false" managed="false"
                              style="-fx-background-color: #FFF3CD; -fx-padding: 15; -fx-background-radius: 8;">
                           <children>
                              <Label text="ðŸ“‹ Form Tambahan untuk Kegiatan Lainnya" 
                                     style="-fx-font-weight: bold; -fx-font-size: 13px;" />
                              
                              <VBox spacing="5.0">
                                 <children>
                                    <Label text="Penjelasan Detail: *" style="-fx-font-weight: bold;" />
                                    <TextArea fx:id="txtPenjelasanKegiatan" prefRowCount="4"
                                              promptText="Jelaskan detail kegiatan (tujuan, peserta, jadwal, dll)"
                                              wrapText="true" />
                                 </children>
                              </VBox>
                              
                              <VBox spacing="5.0">
                                 <children>
                                    <Label text="Upload Surat Permohonan (PDF): *" style="-fx-font-weight: bold;" />
                                    <HBox spacing="10.0" alignment="CENTER_LEFT">
                                       <children>
                                          <Label fx:id="lblSuratName" text="Belum ada file" 
                                                 style="-fx-background-color: white; -fx-padding: 5;" 
                                                 HBox.hgrow="ALWAYS" />
                                          <Button fx:id="btnUploadSurat" text="ðŸ“Ž Pilih File" 
                                                  onAction="#handleUploadSurat" />
                                       </children>
                                    </HBox>
                                    <Label text="Format: PDF, Max 5MB" style="-fx-font-size: 10px; -fx-text-fill: #666;" />
                                 </children>
                              </VBox>
                           </children>
                        </VBox>
                        
                        <!-- Tanggal & Waktu Pinjam -->
                        <VBox spacing="10.0">
                           <children>
                              <HBox spacing="15.0">
                                 <children>
                                    <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                       <children>
                                          <Label text="Tanggal Pinjam: *" style="-fx-font-weight: bold;" />
                                          <DatePicker fx:id="dpTglPinjam" maxWidth="Infinity" 
                                                      onAction="#handleDateChange" />
                                       </children>
                                    </VBox>
                                    <VBox spacing="5.0" prefWidth="250.0">
                                       <children>
                                          <Label text="Jam Mulai: *" style="-fx-font-weight: bold;" />
                                          <HBox spacing="5.0" alignment="CENTER_LEFT">
                                             <children>
                                                <ComboBox fx:id="cbJamMulai" prefWidth="80.0" promptText="HH" />
                                                <Label text=":" />
                                                <ComboBox fx:id="cbMenitMulai" prefWidth="80.0" promptText="mm" />
                                             </children>
                                          </HBox>
                                       </children>
                                    </VBox>
                                 </children>
                              </HBox>
                              
                              <HBox spacing="15.0">
                                 <children>
                                    <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                       <children>
                                          <Label text="Tanggal Kembali: *" style="-fx-font-weight: bold;" />
                                          <DatePicker fx:id="dpTglKembali" maxWidth="Infinity"
                                                      onAction="#handleDateChange" />
                                       </children>
                                    </VBox>
                                    <VBox spacing="5.0" prefWidth="250.0">
                                       <children>
                                          <Label text="Jam Selesai: *" style="-fx-font-weight: bold;" />
                                          <HBox spacing="5.0" alignment="CENTER_LEFT">
                                             <children>
                                                <ComboBox fx:id="cbJamSelesai" prefWidth="80.0" promptText="HH" />
                                                <Label text=":" />
                                                <ComboBox fx:id="cbMenitSelesai" prefWidth="80.0" promptText="mm" />
                                             </children>
                                          </HBox>
                                       </children>
                                    </VBox>
                                 </children>
                              </HBox>
                           </children>
                        </VBox>
                        
                        <!-- Durasi Info -->
                        <HBox fx:id="hboxDurasi" spacing="10.0" visible="false"
                              style="-fx-background-color: #E3F2FD; -fx-padding: 10; -fx-background-radius: 5;">
                           <children>
                              <Label text="â„¹ï¸" style="-fx-font-size: 16px;" />
                              <Label fx:id="lblDurasi" text="Durasi: - hari" style="-fx-font-weight: bold;" />
                           </children>
                        </HBox>
                        
                        <Separator />
                        
                        <!-- Error Label -->
                        <Label fx:id="errorLabel" visible="false" wrapText="true"
                               style="-fx-text-fill: red; -fx-font-weight: bold; -fx-background-color: #ffebee; -fx-padding: 10;" />
                        
                        <!-- Buttons -->
                        <HBox spacing="15.0" alignment="CENTER">
                           <children>
                              <Button fx:id="btnSubmit" text="ðŸ“¤ Ajukan Peminjaman" 
                                      onAction="#handleSubmit" prefWidth="180.0"
                                      style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14px;" />
                              <Button fx:id="btnReset" text="ðŸ”„ Reset" 
                                      onAction="#handleReset" prefWidth="120.0"
                                      style="-fx-background-color: #E8EDF2; -fx-font-weight: bold;" />
                           </children>
                        </HBox>
                        
                        <Label text="* Field wajib diisi" style="-fx-font-size: 11px; -fx-text-fill: #666;" />
                     </children>
                  </VBox>
               </content>
            </ScrollPane>
         </children>
      </VBox>
   </children>
</AnchorPane>